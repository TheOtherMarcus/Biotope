# Biotope
Web Application Server built around the relational data model described in [1]. Text based content, e.g. HTML, Javascript, CSS, GraphViz, JSON is created with the template language described in [2]. Other type of content is created with dedicated Java servlets. Jetty is the default servlet engine. Command line scripts are written in Bash, Python, Make and Ant.

## Installation
Start the installation with a clone of this repo.

```
git clone https://github.com/TheOtherMarcus/Biotope.git
```

Download Jetty [3], extract the archive in the Biotope directory and create a symlink with the name `jetty` to it.

```
cd Biotope
wget http://central.maven.org/maven2/org/eclipse/jetty/jetty-distribution/9.4.6.v20170531/jetty-distribution-9.4.6.v20170531.tar.gz`
tar xvf jetty*
ln -s jetty* jetty
```

Enable basic HTTP authentication in Jetty [4]. Edit jetty/etc/jetty.xml and add the following at the bottom.

```
    <Call name="addBean">
      <Arg>
        <New class="org.eclipse.jetty.security.HashLoginService">
          <Set name="name">Biotope Realm</Set>
          <Set name="config"><SystemProperty name="jetty.home" default="."/>/etc/passwd.properties</Set>
          <Set name="refreshInterval">1000</Set>
          <Call name="start"></Call>
        </New>
      </Arg>
    </Call>
```

Add users to the file `jetty/etc/passwd.properties`. The security roles used by Biotope are `reader` and `writer`.

```
guest: yourewelcome,reader
admin: CRYPT:adgc01se8haby9,reader,writer
```

Encrypted passwords can be generated by a Jetty utility.

```
java -cp jetty/lib/jetty-http-9.2.10.v20150310.jar:jetty/lib/jetty-util-9.2.10.v20150310.jar org.eclipse.jetty.util.security.Password USERNAME PASSWORD
```

Install the Biotope servlets in Jetty. This step assumes you have Java and Ant installed.

```
cd biotope
ant deploy
cd ..
```

Create the database. This step assumes you have PostgreSQL installed. This is typically performed by the postgres user.

```
sudo su - posgtgres

createuser -P -S -R -D biotope
Enter password for new role: biotope

createdb -O biotope -E UTF8 biotope

exit
```

Create the collations you need for correct text handling (e.g. sorting) in PostgreSQL. This also tests that postgres server accepts socket connections from localhost, which is necessary for Biotope to work.

```
psql -h localhost --user biotope biotope
Password for user biotope: biotope
CREATE COLLATION sv_se (LOCALE = 'sv_SE.utf8');
```

Install the default content.

```
cd src
make
cd ..
```

Start Jetty.

```
cd jetty
java -jar start.jar
```

## References
[1] http://formallanguage.blogspot.se/2015/02/a-distributed-and-extensible-relational.html</br>
[2] http://formallanguage.blogspot.se/2017/03/makron-macro-language-and-evaluator.html</br>
[3] http://www.eclipse.org/jetty/</br>
[4] http://whitehorseplanet.org/gate/topics/documentation/public/howto_jetty_basic_authentication.html</br>
